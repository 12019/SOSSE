<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SOSSE: auth.h File Reference</title>
<link href="sos.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>auth.h File Reference</h1>  </div>
</div>
<div class="contents">

<p>Authentication declarations.  
<a href="#_details">More...</a></p>
<code>#include &lt;<a class="el" href="types_8h_source.html">types.h</a>&gt;</code><br/>

<p><a href="auth_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#aeaa1f3d53530fd751bea7f48a6ee7cc6">AUTH_FLAG_PIN</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag for authstate signalling a successful PIN verification.  <a href="#aeaa1f3d53530fd751bea7f48a6ee7cc6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a1defcbb7e6fa25bac6924c00f4614d35">AUTH_FLAG_KEY</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag for authstate signalling a successful external authentication or key verification.  <a href="#a1defcbb7e6fa25bac6924c00f4614d35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a06f918f6ed2d5e24c682eb3ae194bca4">AUTH_AC_ALW</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Always.  <a href="#a06f918f6ed2d5e24c682eb3ae194bca4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#afc10b497322dc030b5ac5071323404e9">AUTH_AC_PIN</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN.  <a href="#afc10b497322dc030b5ac5071323404e9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#adb433f11e23690ebc205ad9b03da9a74">AUTH_AC_ADM</a>&nbsp;&nbsp;&nbsp;0x2</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Key.  <a href="#adb433f11e23690ebc205ad9b03da9a74"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a3272751b0b790ce197a9c07e3b5d2d2f">AUTH_AC_POA</a>&nbsp;&nbsp;&nbsp;0x3</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN or Key.  <a href="#a3272751b0b790ce197a9c07e3b5d2d2f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#af7bd31be6d42c810ad1468f5442b5de5">AUTH_AC_PAA</a>&nbsp;&nbsp;&nbsp;0x4</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN and Key.  <a href="#af7bd31be6d42c810ad1468f5442b5de5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#aaf38cf2754820c9bbcbc5957fe7e509e">AUTH_AC_NEV</a>&nbsp;&nbsp;&nbsp;0xF</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Never.  <a href="#aaf38cf2754820c9bbcbc5957fe7e509e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a9d8b6ae7a1c5ef072de2ad65e09d83d0">PIN_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for PIN.  <a href="#a9d8b6ae7a1c5ef072de2ad65e09d83d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#ac9ce57082eb69177a95b5f63576cb2a1">PUK_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for PUK.  <a href="#ac9ce57082eb69177a95b5f63576cb2a1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#aaac17c4b13fe3e78f5f1a24e91028c77">PIN_TYPE_PIN</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: PIN.  <a href="#aaac17c4b13fe3e78f5f1a24e91028c77"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a793126c282da300f00f6a8ce2186fc53">PIN_TYPE_PUK</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: PUK.  <a href="#a793126c282da300f00f6a8ce2186fc53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a6a0731f5c1b41bc071daa21d4c8fa6f7">PIN_TYPE_EXT</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: Key for external authentication.  <a href="#a6a0731f5c1b41bc071daa21d4c8fa6f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a6bd15adfa11f15032db1be399133900d">PIN_TYPE_INT</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: Key for internal authentication.  <a href="#a6bd15adfa11f15032db1be399133900d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#ae20960801ae4dbb25ee1ee1144bf254f">KEY_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for keys.  <a href="#ae20960801ae4dbb25ee1ee1144bf254f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a541eaea66766d1a05996828684dcb8db">AUTH_FID_EXTAUTH</a>&nbsp;&nbsp;&nbsp;0xFF00</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with external authentication key.  <a href="#a541eaea66766d1a05996828684dcb8db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a3a7070ba17e95804b8d5b2ba35b3dfd3">AUTH_FID_INTAUTH</a>&nbsp;&nbsp;&nbsp;0xFF01</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with internal authentication key.  <a href="#a3a7070ba17e95804b8d5b2ba35b3dfd3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#ae7b41b442d484fa239a006c8b9a5f93c">AUTH_FID_PINPUK</a>&nbsp;&nbsp;&nbsp;0xFF02</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with PIN and PUK.  <a href="#ae7b41b442d484fa239a006c8b9a5f93c"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a98aca8fb3854ee1499ce6540ae5b893f">auth_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize authentication variables.  <a href="#a98aca8fb3854ee1499ce6540ae5b893f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> ac)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check fullfillment of access condition.  <a href="#ac9b9b2622243783169e7ae66af6f0ae0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen, <a class="el" href="types_8h.html#af78b002cffb8a135ab10841bc49e3e14">iu16</a> *addr, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *len, <a class="el" href="types_8h.html#af78b002cffb8a135ab10841bc49e3e14">iu16</a> *rcaddr, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *maxret)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verifies length of PIN and returns addresses of PIN in EEPROM.  <a href="#a57b022e6fdb6bbdd9c479d3a6b9fb6c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#af345ee6ff731358a899c18c49bb43505">auth_setPin</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *pin, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write PIN, PUK, External Authentication key or Internal Authentication key.  <a href="#af345ee6ff731358a899c18c49bb43505"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#acc47f8e744b936363d64dc20e818ac09">auth_verifyPin</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *pin, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verifies PIN, PUK or External Authentication key and sets flags in authstate.  <a href="#acc47f8e744b936363d64dc20e818ac09"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a946f4f893b73a4170f27f9c8a181e9bb">auth_getChallenge</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *<a class="el" href="log_8c.html#a3c30da82b7bc91b5520d2fb84ffeb4dd">dst</a>, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> rndlen)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns 8 byte challenge for External Authentication.  <a href="#a946f4f893b73a4170f27f9c8a181e9bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram</a> (<a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *cry, <a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> crylen, <a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> create, <a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> enc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encrypt or decrypt challenge or verify cryptogram.  <a href="#a317f35613a5f25da955d5ec69a8671c7"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#add47c1a71dba136bb77c433df3b0914b">challvalidity</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Validity of challenge.  <a href="#add47c1a71dba136bb77c433df3b0914b"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Authentication declarations. </p>
<p>Here are the declarations and definitions for the authentication functions. The authentication types supported are:</p>
<ul>
<li>
PIN/PUK </li>
<li>
External Authentication </li>
<li>
Internal Authentication </li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Here are certainly some optimizations possible to reduce code size.</dd></dl>
<dl class="rcs"><dt><b>Id:</b></dt><dd><a class="el" href="auth_8h.html" title="Authentication declarations.">auth.h</a>,v 1.11 2002/12/22 15:42:55 m Exp </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="adb433f11e23690ebc205ad9b03da9a74"></a><!-- doxytag: member="auth.h::AUTH_AC_ADM" ref="adb433f11e23690ebc205ad9b03da9a74" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_ADM&nbsp;&nbsp;&nbsp;0x2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: Key. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>, and <a class="el" href="fstest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a06f918f6ed2d5e24c682eb3ae194bca4"></a><!-- doxytag: member="auth.h::AUTH_AC_ALW" ref="a06f918f6ed2d5e24c682eb3ae194bca4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_ALW&nbsp;&nbsp;&nbsp;0x0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: Always. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>, and <a class="el" href="fstest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf38cf2754820c9bbcbc5957fe7e509e"></a><!-- doxytag: member="auth.h::AUTH_AC_NEV" ref="aaf38cf2754820c9bbcbc5957fe7e509e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_NEV&nbsp;&nbsp;&nbsp;0xF</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: Never. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>.</p>

</div>
</div>
<a class="anchor" id="af7bd31be6d42c810ad1468f5442b5de5"></a><!-- doxytag: member="auth.h::AUTH_AC_PAA" ref="af7bd31be6d42c810ad1468f5442b5de5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_PAA&nbsp;&nbsp;&nbsp;0x4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: PIN and Key. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>.</p>

</div>
</div>
<a class="anchor" id="afc10b497322dc030b5ac5071323404e9"></a><!-- doxytag: member="auth.h::AUTH_AC_PIN" ref="afc10b497322dc030b5ac5071323404e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_PIN&nbsp;&nbsp;&nbsp;0x1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: PIN. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>, and <a class="el" href="fstest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a3272751b0b790ce197a9c07e3b5d2d2f"></a><!-- doxytag: member="auth.h::AUTH_AC_POA" ref="a3272751b0b790ce197a9c07e3b5d2d2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_POA&nbsp;&nbsp;&nbsp;0x3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Access Condition: PIN or Key. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>, and <a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram()</a>.</p>

</div>
</div>
<a class="anchor" id="a541eaea66766d1a05996828684dcb8db"></a><!-- doxytag: member="auth.h::AUTH_FID_EXTAUTH" ref="a541eaea66766d1a05996828684dcb8db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_EXTAUTH&nbsp;&nbsp;&nbsp;0xFF00</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>FID for file with external authentication key. </p>
<p>It is only searched for the file in the MF and not in any DF. </p>

</div>
</div>
<a class="anchor" id="a3a7070ba17e95804b8d5b2ba35b3dfd3"></a><!-- doxytag: member="auth.h::AUTH_FID_INTAUTH" ref="a3a7070ba17e95804b8d5b2ba35b3dfd3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_INTAUTH&nbsp;&nbsp;&nbsp;0xFF01</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>FID for file with internal authentication key. </p>
<p>It is only searched for the file in the MF and not in any DF. </p>

</div>
</div>
<a class="anchor" id="ae7b41b442d484fa239a006c8b9a5f93c"></a><!-- doxytag: member="auth.h::AUTH_FID_PINPUK" ref="ae7b41b442d484fa239a006c8b9a5f93c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_PINPUK&nbsp;&nbsp;&nbsp;0xFF02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>FID for file with PIN and PUK. </p>
<p>It is only searched for the file in the MF and not in any DF. </p>

</div>
</div>
<a class="anchor" id="a1defcbb7e6fa25bac6924c00f4614d35"></a><!-- doxytag: member="auth.h::AUTH_FLAG_KEY" ref="a1defcbb7e6fa25bac6924c00f4614d35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FLAG_KEY&nbsp;&nbsp;&nbsp;0x02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag for authstate signalling a successful external authentication or key verification. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>.</p>

</div>
</div>
<a class="anchor" id="aeaa1f3d53530fd751bea7f48a6ee7cc6"></a><!-- doxytag: member="auth.h::AUTH_FLAG_PIN" ref="aeaa1f3d53530fd751bea7f48a6ee7cc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FLAG_PIN&nbsp;&nbsp;&nbsp;0x01</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag for authstate signalling a successful PIN verification. </p>

<p>Referenced by <a class="el" href="auth_8h.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>.</p>

</div>
</div>
<a class="anchor" id="ae20960801ae4dbb25ee1ee1144bf254f"></a><!-- doxytag: member="auth.h::KEY_MAX_RETRIES" ref="ae20960801ae4dbb25ee1ee1144bf254f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KEY_MAX_RETRIES&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default max. retries for keys. </p>

</div>
</div>
<a class="anchor" id="a9d8b6ae7a1c5ef072de2ad65e09d83d0"></a><!-- doxytag: member="auth.h::PIN_MAX_RETRIES" ref="a9d8b6ae7a1c5ef072de2ad65e09d83d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_MAX_RETRIES&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default max. retries for PIN. </p>

</div>
</div>
<a class="anchor" id="a6a0731f5c1b41bc071daa21d4c8fa6f7"></a><!-- doxytag: member="auth.h::PIN_TYPE_EXT" ref="a6a0731f5c1b41bc071daa21d4c8fa6f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_EXT&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PIN type: Key for external authentication. </p>

<p>Referenced by <a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram()</a>, <a class="el" href="auth_8h.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, <a class="el" href="auth_8h.html#acc47f8e744b936363d64dc20e818ac09">auth_verifyPin()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a6bd15adfa11f15032db1be399133900d"></a><!-- doxytag: member="auth.h::PIN_TYPE_INT" ref="a6bd15adfa11f15032db1be399133900d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_INT&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PIN type: Key for internal authentication. </p>

<p>Referenced by <a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram()</a>, and <a class="el" href="auth_8h.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>.</p>

</div>
</div>
<a class="anchor" id="aaac17c4b13fe3e78f5f1a24e91028c77"></a><!-- doxytag: member="auth.h::PIN_TYPE_PIN" ref="aaac17c4b13fe3e78f5f1a24e91028c77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_PIN&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PIN type: PIN. </p>

<p>Referenced by <a class="el" href="auth_8h.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, <a class="el" href="auth_8h.html#acc47f8e744b936363d64dc20e818ac09">auth_verifyPin()</a>, <a class="el" href="commands_8h.html#aece92ed730ad9d4e7ccb4cd08555c0b7">cmd_changeUnblockPIN()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a793126c282da300f00f6a8ce2186fc53"></a><!-- doxytag: member="auth.h::PIN_TYPE_PUK" ref="a793126c282da300f00f6a8ce2186fc53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_PUK&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PIN type: PUK. </p>

<p>Referenced by <a class="el" href="auth_8h.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9ce57082eb69177a95b5f63576cb2a1"></a><!-- doxytag: member="auth.h::PUK_MAX_RETRIES" ref="ac9ce57082eb69177a95b5f63576cb2a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PUK_MAX_RETRIES&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default max. retries for PUK. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac9b9b2622243783169e7ae66af6f0ae0"></a><!-- doxytag: member="auth.h::auth_checkAc" ref="ac9b9b2622243783169e7ae66af6f0ae0" args="(iu8 ac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_checkAc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>ac</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check fullfillment of access condition. </p>
<p>This function checks, if the current setting of authstate fullfills the condition specified with <em>ac</em>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ac</em>&nbsp;</td><td>A nibble specifying an access condition.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="auth_8h.html#adb433f11e23690ebc205ad9b03da9a74">AUTH_AC_ADM</a>, <a class="el" href="auth_8h.html#a06f918f6ed2d5e24c682eb3ae194bca4">AUTH_AC_ALW</a>, <a class="el" href="auth_8h.html#aaf38cf2754820c9bbcbc5957fe7e509e">AUTH_AC_NEV</a>, <a class="el" href="auth_8h.html#af7bd31be6d42c810ad1468f5442b5de5">AUTH_AC_PAA</a>, <a class="el" href="auth_8h.html#afc10b497322dc030b5ac5071323404e9">AUTH_AC_PIN</a>, <a class="el" href="auth_8h.html#a3272751b0b790ce197a9c07e3b5d2d2f">AUTH_AC_POA</a>, <a class="el" href="auth_8h.html#a1defcbb7e6fa25bac6924c00f4614d35">AUTH_FLAG_KEY</a>, <a class="el" href="auth_8h.html#aeaa1f3d53530fd751bea7f48a6ee7cc6">AUTH_FLAG_PIN</a>, <a class="el" href="auth_8c.html#ac023311503326e98022248d8e937b837">authstate</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16af5dea942e1140e049f80d4586d7348fb">SW_ACCESS_DENIED</a>, and <a class="el" href="sw_8c.html#a06244878ad482424dc04d05cfdc81b7b">sw_set()</a>.</p>

<p>Referenced by <a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram()</a>, <a class="el" href="commands_8h.html#a3c4d6ec9b132006edab635f42f6b1143">cmd_create()</a>, <a class="el" href="commands_8h.html#ab5e91199098e25652dd3dbc7aea27683">cmd_delete()</a>, <a class="el" href="commands_8h.html#a892cbb2f7983a3bca95719fa78397eb4">cmd_readBinary()</a>, <a class="el" href="commands_8h.html#aa4f0817c641ea482d8bbd9a62d4a56b5">cmd_updateBinary()</a>, and <a class="el" href="fstest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a317f35613a5f25da955d5ec69a8671c7"></a><!-- doxytag: member="auth.h::auth_createVerifyCryptogram" ref="a317f35613a5f25da955d5ec69a8671c7" args="(iu8 *cry, iu8 crylen, bool create, bool enc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_createVerifyCryptogram </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>cry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>crylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td>
          <td class="paramname"> <em>create</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td>
          <td class="paramname"> <em>enc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Encrypt or decrypt challenge or verify cryptogram. </p>
<p>To include the decryption process CONF_WITH_DECRYPT must be set to 1.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cry</em>&nbsp;</td><td>Pointer to byte array, which supplies challenge and which is used to return the encrypted or decrypted challenge or a cryptogram. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>crylen</em>&nbsp;</td><td>Length of challenge or cryptogram. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>create</em>&nbsp;</td><td>If set to TRUE, a challenge is processed, else a cryptogram is verified. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>enc</em>&nbsp;</td><td>If CONF_WITH_DECRYPT is not set to 1, this has no effect. Otherwise, if TRUE encrypt the challenge, else decrypt it. If <em>create</em> is FALSE, this parameter is ignored.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="config_8h.html#a2bb18fa86e052ac2ec39f3a373e7636b">ADM_KEY_LEN</a>, <a class="el" href="auth_8h.html#a3272751b0b790ce197a9c07e3b5d2d2f">AUTH_AC_POA</a>, <a class="el" href="auth_8c.html#ac9b9b2622243783169e7ae66af6f0ae0">auth_checkAc()</a>, <a class="el" href="auth_8c.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, <a class="el" href="auth_8c.html#ac023311503326e98022248d8e937b837">authstate</a>, <a class="el" href="auth_8c.html#a2ee8f81f054acabfbfc54e48cbcd069a">challenge</a>, <a class="el" href="auth_8c.html#add47c1a71dba136bb77c433df3b0914b">challvalidity</a>, <a class="el" href="crypt_8h.html#a43b1d04245c8e15c46757997a948488d">CRYPT_BLOCK_LEN</a>, <a class="el" href="crypt_8h.html#acf91dd768c8cafdd5ff51dffe52a23f4">crypt_dec</a>, <a class="el" href="crypt_8h.html#a2b72079265df1125bb812c9c16fbe801">crypt_enc</a>, <a class="el" href="hal-emu_8c.html#ae23736f92fbd6e59f6e67a191e69ecef">hal_eeprom_read()</a>, <a class="el" href="hal-emu_8c.html#a19f6e1f1e627521793f250459c5e49b8">hal_eeprom_write()</a>, <a class="el" href="auth_8h.html#a6a0731f5c1b41bc071daa21d4c8fa6f7">PIN_TYPE_EXT</a>, <a class="el" href="auth_8h.html#a6bd15adfa11f15032db1be399133900d">PIN_TYPE_INT</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16af2dae541c1660470465d87ad26e403d1">SW_AUTH_BLOCKED</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a25c477063bc7a878924b8a22e5360d4e">SW_COUNTER</a>, <a class="el" href="sw_8c.html#a06244878ad482424dc04d05cfdc81b7b">sw_set()</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a3bbe413116997e6ba3153998a01eb3f5">SW_WRONG_CONDITION</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a8912359f8b7011f6e0bef47a566ef759">SW_WRONG_LEN</a>, <a class="el" href="transaction_8c.html#acacd724418635980cbe9ff7caab01e9c">ta_commit()</a>, and <a class="el" href="transaction_8c.html#ae0ead4e9d2dc0e305973f13324a356aa">ta_setdata()</a>.</p>

<p>Referenced by <a class="el" href="commands_8h.html#a6479b741d6f5b343e356290db8153021">cmd_extAuth()</a>, <a class="el" href="commands_8h.html#ad18d7d2bb0f030accf5e0456b2927411">cmd_intAuth()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a946f4f893b73a4170f27f9c8a181e9bb"></a><!-- doxytag: member="auth.h::auth_getChallenge" ref="a946f4f893b73a4170f27f9c8a181e9bb" args="(iu8 *dst, iu8 rndlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_getChallenge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>rndlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns 8 byte challenge for External Authentication. </p>
<p>The challenge is also written to the challenge array and challvalidity is set to 2.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>Destination byte array. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rndlen</em>&nbsp;</td><td>Length of requested data. This must be 8.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="auth_8c.html#a2ee8f81f054acabfbfc54e48cbcd069a">challenge</a>, <a class="el" href="auth_8c.html#add47c1a71dba136bb77c433df3b0914b">challvalidity</a>, <a class="el" href="crypt_8h.html#a43b1d04245c8e15c46757997a948488d">CRYPT_BLOCK_LEN</a>, <a class="el" href="hal-emu_8c.html#a4dfdfc55f93a2f674edd64b10e8332ae">hal_rnd_getBlock()</a>, <a class="el" href="sw_8c.html#a06244878ad482424dc04d05cfdc81b7b">sw_set()</a>, and <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a8912359f8b7011f6e0bef47a566ef759">SW_WRONG_LEN</a>.</p>

<p>Referenced by <a class="el" href="commands_8h.html#a6feeac5b3883560af0faec05f1a090b2">cmd_getChallenge()</a>.</p>

</div>
</div>
<a class="anchor" id="a57b022e6fdb6bbdd9c479d3a6b9fb6c0"></a><!-- doxytag: member="auth.h::auth_getCheckPinLen" ref="a57b022e6fdb6bbdd9c479d3a6b9fb6c0" args="(iu8 pintype, iu8 pinlen, iu16 *addr, iu8 *len, iu16 *rcaddr, iu8 *maxret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_getCheckPinLen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af78b002cffb8a135ab10841bc49e3e14">iu16</a> *&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af78b002cffb8a135ab10841bc49e3e14">iu16</a> *&nbsp;</td>
          <td class="paramname"> <em>rcaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>maxret</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verifies length of PIN and returns addresses of PIN in EEPROM. </p>
<p>This functions does depending on <em>pintype</em>:</p>
<ul>
<li>
Check the length of the PIN or key. </li>
<li>
Return the address of the PIN or key in EEPROM. </li>
<li>
Return the length of the PIN or key in EEPROM. </li>
<li>
Return the address of the retry counter in EEPROM. </li>
<li>
Return the default max. value for the retry counter. </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>PIN type. One of the PIN_TYPE defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of supplied PIN or key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Returns the address of the PIN or key in EEPROM. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Returns the length ofthe PIN or key in EEPROM. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rcaddr</em>&nbsp;</td><td>Returns the address of the retry counter for the PIN or key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxret</em>&nbsp;</td><td>Returns the default max. value for the retry counter.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="config_8h.html#a2bb18fa86e052ac2ec39f3a373e7636b">ADM_KEY_LEN</a>, <a class="el" href="structs__fpath.html#aa16acae1b4ba3966c13fe44b278ced64">s_fpath::df</a>, <a class="el" href="structs__fpath.html#ae8103a76874a6b0588c88303126477c7">s_fpath::ef</a>, <a class="el" href="fs_8c.html#a53716a136dbb532afc17ffc353b9d69c">fs_getData()</a>, <a class="el" href="fs_8h.html#ac1246e5b596fad2ca69d5740720dce64">FS_TYPE_EF</a>, <a class="el" href="config_8h.html#a771eb45b50b7bc18cc8c193e3d20ec43">INT_KEY_LEN</a>, <a class="el" href="config_8h.html#ada8fbdb1ee37b5449c94aa2601579227">PIN_LEN</a>, <a class="el" href="auth_8h.html#a6a0731f5c1b41bc071daa21d4c8fa6f7">PIN_TYPE_EXT</a>, <a class="el" href="auth_8h.html#a6bd15adfa11f15032db1be399133900d">PIN_TYPE_INT</a>, <a class="el" href="auth_8h.html#aaac17c4b13fe3e78f5f1a24e91028c77">PIN_TYPE_PIN</a>, <a class="el" href="auth_8h.html#a793126c282da300f00f6a8ce2186fc53">PIN_TYPE_PUK</a>, <a class="el" href="config_8h.html#a92a6c15bc95b977bddac858cba15bafe">PUK_LEN</a>, <a class="el" href="structs__fstream.html#ab803d160e579a1969b9803f19b7a0814">s_fstream::size</a>, <a class="el" href="structs__fstream.html#a4427473894e909d279b9fb12fba358e5">s_fstream::start</a>, <a class="el" href="sw_8c.html#a814d554b939d5196ce21afb6562e0a05">sw</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16ad983f0d2b14b39d009aa879049ca3d64">SW_FILE_NOT_FOUND</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16aa770ca9bfd6bb76490fe0abbe99d7bc0">SW_OTHER</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a3e1a16db493d8245e8a29b3082660684">SW_REF_DATA_NOT_FOUND</a>, <a class="el" href="sw_8c.html#a06244878ad482424dc04d05cfdc81b7b">sw_set()</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a8912359f8b7011f6e0bef47a566ef759">SW_WRONG_LEN</a>, and <a class="el" href="structs__finfo.html#a41bbc495939ea65ac01a8e210bf9a47c">s_finfo::type</a>.</p>

<p>Referenced by <a class="el" href="auth_8h.html#a317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram()</a>, <a class="el" href="auth_8h.html#af345ee6ff731358a899c18c49bb43505">auth_setPin()</a>, and <a class="el" href="auth_8h.html#acc47f8e744b936363d64dc20e818ac09">auth_verifyPin()</a>.</p>

</div>
</div>
<a class="anchor" id="a98aca8fb3854ee1499ce6540ae5b893f"></a><!-- doxytag: member="auth.h::auth_init" ref="a98aca8fb3854ee1499ce6540ae5b893f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize authentication variables. </p>
<p>This function resets authstate and challvalidity. It must be called after reset.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="auth_8c.html#ac023311503326e98022248d8e937b837">authstate</a>, and <a class="el" href="auth_8c.html#add47c1a71dba136bb77c433df3b0914b">challvalidity</a>.</p>

<p>Referenced by <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="af345ee6ff731358a899c18c49bb43505"></a><!-- doxytag: member="auth.h::auth_setPin" ref="af345ee6ff731358a899c18c49bb43505" args="(iu8 pintype, iu8 *pin, iu8 pinlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_setPin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write PIN, PUK, External Authentication key or Internal Authentication key. </p>
<p>The process is secured by transactions.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>Type of the PIN/Key. May be one of the PIN_TYPE_* defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pin</em>&nbsp;</td><td>Pointer to byte array containing PIN/Key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of PIN/Key.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="auth_8c.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, <a class="el" href="hal-emu_8c.html#a19f6e1f1e627521793f250459c5e49b8">hal_eeprom_write()</a>, <a class="el" href="transaction_8c.html#acacd724418635980cbe9ff7caab01e9c">ta_commit()</a>, and <a class="el" href="transaction_8c.html#ae0ead4e9d2dc0e305973f13324a356aa">ta_setdata()</a>.</p>

<p>Referenced by <a class="el" href="commands_8h.html#aece92ed730ad9d4e7ccb4cd08555c0b7">cmd_changeUnblockPIN()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="acc47f8e744b936363d64dc20e818ac09"></a><!-- doxytag: member="auth.h::auth_verifyPin" ref="acc47f8e744b936363d64dc20e818ac09" args="(iu8 pintype, iu8 *pin, iu8 pinlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> auth_verifyPin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verifies PIN, PUK or External Authentication key and sets flags in authstate. </p>
<p>The update of the retry counter is secured by transactions.</p>
<p><em>Warning: Currently the retry counter is not handled in a secure way. For more information see e.g. Rankl/Effing.</em></p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>Type of the PIN/Key. May be one of the PIN_TYPE_* defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pin</em>&nbsp;</td><td>Pointer to byte array containing PIN/Key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of PIN/Key.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="auth_8c.html#a57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen()</a>, <a class="el" href="auth_8c.html#ac023311503326e98022248d8e937b837">authstate</a>, <a class="el" href="hal-emu_8c.html#ae23736f92fbd6e59f6e67a191e69ecef">hal_eeprom_read()</a>, <a class="el" href="hal-emu_8c.html#a19f6e1f1e627521793f250459c5e49b8">hal_eeprom_write()</a>, <a class="el" href="auth_8h.html#a6a0731f5c1b41bc071daa21d4c8fa6f7">PIN_TYPE_EXT</a>, <a class="el" href="auth_8h.html#aaac17c4b13fe3e78f5f1a24e91028c77">PIN_TYPE_PIN</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16af2dae541c1660470465d87ad26e403d1">SW_AUTH_BLOCKED</a>, <a class="el" href="sw_8h.html#ac5377a40197386a6b59fbf99128e0c16a25c477063bc7a878924b8a22e5360d4e">SW_COUNTER</a>, <a class="el" href="sw_8c.html#a06244878ad482424dc04d05cfdc81b7b">sw_set()</a>, <a class="el" href="transaction_8c.html#acacd724418635980cbe9ff7caab01e9c">ta_commit()</a>, and <a class="el" href="transaction_8c.html#ae0ead4e9d2dc0e305973f13324a356aa">ta_setdata()</a>.</p>

<p>Referenced by <a class="el" href="commands_8h.html#aece92ed730ad9d4e7ccb4cd08555c0b7">cmd_changeUnblockPIN()</a>, <a class="el" href="commands_8h.html#a8483dd469cbec8917e02d57f1059ef9c">cmd_verifyKeyPIN()</a>, and <a class="el" href="authtest_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="add47c1a71dba136bb77c433df3b0914b"></a><!-- doxytag: member="auth.h::challvalidity" ref="add47c1a71dba136bb77c433df3b0914b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a95a7dea5cbac1a117a50dccc69944d6e">iu8</a> <a class="el" href="authtest_8c.html#add47c1a71dba136bb77c433df3b0914b">challvalidity</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Validity of challenge. </p>
<p>The initial value if challvalidity is 2. This is decremented at the start of the command loop, so that it is 1 at the command following a Get Challenge. </p>

</div>
</div>
</div>
<hr><address><small>
Copyright 2002 by Matthias Bruestle. This is licensed under the GNU
General Public License.
</small></address>
</body>
</html>
